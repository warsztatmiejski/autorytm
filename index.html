<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Beatmaker</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #282c34;
        }
        #controls {
            margin-bottom: 10px;
        }
        canvas {
            border: 1px solid #444;
            background: #333;
        }
    </style>
</head>
<body>
    <canvas id="beatCanvas"></canvas>
    <script>
        const audioFolder = 'audio/';
        const soundLibrary = [
            'kick.wav',
            'snare.wav',
            'hihat.wav',
            'tom.wav'
        ];

        const numTracks = soundLibrary.length;
        const numBeats = 16;
        const cellSize = 40;
        const canvas = document.getElementById('beatCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = (numBeats + 1) * cellSize;
        canvas.height = numTracks * cellSize;

        let beatGrid = Array.from({ length: numTracks }, () => Array(numBeats).fill(false));
        let currentBeat = 0;
        let sounds = soundLibrary.map(sound => new Audio(audioFolder + sound));

        // Create dropdowns for selecting sounds
        function createTrackControls() {
            for (let i = 0; i < numTracks; i++) {
                const select = document.createElement('select');
                soundLibrary.forEach((sound, index) => {
                    const option = document.createElement('option');
                    option.value = audioFolder + sound;
                    option.textContent = sound;
                    if (index === i) option.selected = true;
                    select.appendChild(option);
                });
                select.addEventListener('change', (e) => {
                    sounds[i] = new Audio(e.target.value);
                });
                const x = 0;
                const y = i * cellSize;
                ctx.fillStyle = '#444';
                ctx.fillRect(x, y, cellSize, cellSize);
                ctx.strokeStyle = '#555';
                ctx.strokeRect(x, y, cellSize, cellSize);
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.fillText(soundLibrary[i].split('.')[0], x + 5, y + 20);
                select.style.position = 'absolute';
                select.style.left = `${x + 5}px`;
                select.style.top = `${y + 5}px`;
                document.body.appendChild(select);
            }
        }

        function drawGrid() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let track = 0; track < numTracks; track++) {
                for (let beat = 0; beat < numBeats; beat++) {
                    ctx.strokeStyle = '#555';
                    ctx.strokeRect((beat + 1) * cellSize, track * cellSize, cellSize, cellSize);
                    if (beatGrid[track][beat]) {
                        ctx.fillStyle = '#00ff00';
                        ctx.fillRect((beat + 1) * cellSize + 2, track * cellSize + 2, cellSize - 4, cellSize - 4);
                    }
                }
            }
            // Highlight current beat
            ctx.fillStyle = 'rgba(255, 255, 0, 0.2)';
            ctx.fillRect((currentBeat + 1) * cellSize, 0, cellSize, canvas.height);
        }

        function toggleCell(x, y) {
            const beat = Math.floor(x / cellSize) - 1;
            const track = Math.floor(y / cellSize);
            if (track < numTracks && beat >= 0 && beat < numBeats) {
                beatGrid[track][beat] = !beatGrid[track][beat];
            }
        }

        function playBeat() {
            for (let track = 0; track < numTracks; track++) {
                if (beatGrid[track][currentBeat]) {
                    sounds[track].currentTime = 0;
                    sounds[track].play();
                }
            }
            currentBeat = (currentBeat + 1) % numBeats;
            drawGrid();
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            toggleCell(x, y);
            drawGrid();
        });

        setInterval(playBeat, 150); // 150ms per beat (~100 BPM)

        createTrackControls();
        drawGrid();
    </script>
</body>
</html>